1970-01-01 00:00:15|SELECT t.msisdn, t.eventDate FROM ( SELECT msisdn, eventDate, CASE WHEN balanceBefore <=  10 AND balanceAfter >  10 THEN 'A' WHEN balanceBefore >  10 AND balanceAfter <=  10 THEN 'C' ELSE 'B' END AS patternVal FROM source_table ) t LEFT JOIN ( SELECT x.msisdn, x.`timestamp` , x.begin_date FROM source_table MATCH_RECOGNIZE ( PARTITION BY msisdn ORDER BY user_action_time MEASURES LAST(user_action_time) AS `timestamp`, A.eventDate AS begin_date ONE ROW PER MATCH AFTER MATCH SKIP PAST LAST ROW PATTERN (A B*? C)  WITHIN INTERVAL '25' SECOND DEFINE A AS A.balanceBefore <=  10 AND A.balanceAfter >  10, C AS C.balanceBefore >  10 AND C.balanceAfter <=  10 ) AS x ) p ON t.msisdn = p.msisdn AND t.eventDate = p.begin_date WHERE  t.patternVal = 'A' AND p.msisdn is null